{% extends 'new_base.html.twig' %}

{% block title %}Elliteam - Je d√©pose ma candidature{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/candidates.css') }}">
{% endblock %}

{% block main %}
    <a href="{{ path('app_home') }}" class="back-link">Retour √† l'accueil</a>

    <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ -->
    <div class="candidate-header">
        <span class="candidate-header__badge">Candidats</span>
        <h2>Je d√©pose ma candidature</h2>
        <p>Partagez votre profil et vos envies avec nous.<br>Nous sommes impatients de d√©couvrir votre talent !</p>
        <div class="candidate-header__badges">
            <span class="candidate-badge">üéØ CDI & Prestation</span>
            <span class="candidate-badge">üîí Donn√©es confidentielles</span>
            <span class="candidate-badge">‚ö° R√©ponse rapide</span>
        </div>
    </div>

    {% for message in app.flashes('error') %}
        <div class="alert alert-danger" role="alert">{{ message }}</div>
    {% endfor %}

    <!-- ‚îÄ‚îÄ Formulaire ‚îÄ‚îÄ -->
    <div id="formContainer">
        {{ form_start(form, {'attr': {'id': 'candidatureForm', 'novalidate': 'novalidate'}}) }}

            <!-- Section 1 : Vos informations -->
            <div class="form-section">
                <div class="form-section__title">
                    <span class="form-section__number form-section__number--yellow">1</span>
                    Vos informations
                </div>

                <div class="form-group">
                    <label for="{{ form.nomPrenom.vars.id }}" class="form-label">
                        Nom / Pr√©nom<span class="required">*</span>
                    </label>
                    {{ form_widget(form.nomPrenom, {'attr': {'class': 'form-input', 'placeholder': 'Votre nom et pr√©nom'}}) }}
                    {{ form_errors(form.nomPrenom) }}
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.email.vars.id }}" class="form-label">
                            Email<span class="required">*</span>
                        </label>
                        {{ form_widget(form.email, {'attr': {'class': 'form-input', 'placeholder': 'votre.email@exemple.com'}}) }}
                        {{ form_errors(form.email) }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.telephone.vars.id }}" class="form-label">
                            T√©l√©phone<span class="required">*</span>
                        </label>
                        {{ form_widget(form.telephone, {'attr': {'class': 'form-input', 'placeholder': '06 12 34 56 78'}}) }}
                        {{ form_errors(form.telephone) }}
                    </div>
                </div>
            </div>

            <!-- Section 2 : Votre profil -->
            <div class="form-section">
                <div class="form-section__title">
                    <span class="form-section__number form-section__number--yellow">2</span>
                    Votre profil
                </div>

                <div class="form-group">
                    <label for="{{ form.posteRecherche.vars.id }}" class="form-label">
                        Poste recherch√©<span class="required">*</span>
                    </label>
                    {{ form_widget(form.posteRecherche, {'attr': {'class': 'form-input', 'placeholder': 'Ex: D√©veloppeur Web, Designer UI/UX, Chef de projet...'}}) }}
                    {{ form_errors(form.posteRecherche) }}
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.pretentionSalariale.vars.id }}" class="form-label">
                            Pr√©tention salariale<span class="required">*</span>
                        </label>
                        {{ form_widget(form.pretentionSalariale, {'attr': {'class': 'form-input', 'placeholder': 'Ex: 45K‚Ç¨, √Ä n√©gocier...'}}) }}
                        <p class="help-text">Indiquez votre fourchette ou "√Ä n√©gocier"</p>
                        {{ form_errors(form.pretentionSalariale) }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.disponibilite.vars.id }}" class="form-label">
                            Disponibilit√©<span class="required">*</span>
                        </label>
                        {{ form_widget(form.disponibilite, {'attr': {'class': 'form-select'}}) }}
                        {{ form_errors(form.disponibilite) }}
                    </div>
                </div>
            </div>

            <!-- Section 3 : Documents & message -->
            <div class="form-section">
                <div class="form-section__title">
                    <span class="form-section__number form-section__number--yellow">3</span>
                    Documents & message
                </div>

                <div class="form-group">
                    <label for="{{ form.cvFile.vars.id }}" class="form-label">
                        CV<span class="required">*</span>
                    </label>
                    <div class="file-input-wrapper">
                        <label for="{{ form.cvFile.vars.id }}" class="file-input-label required-file" id="cvLabel">
                            <span class="file-input-icon">üìÑ</span>
                            <span>Joindre votre CV (PDF uniquement ‚Äî max 5 Mo) ‚Äî Obligatoire</span>
                        </label>
                        {{ form_widget(form.cvFile, {'attr': {'class': 'file-input', 'accept': '.pdf'}}) }}
                    </div>
                    <div id="cvFileName" class="file-name"></div>
                    {{ form_errors(form.cvFile) }}
                </div>

                <div class="form-group">
                    <label for="{{ form.message.vars.id }}" class="form-label">
                        Message / Pr√©sentation rapide
                        <span class="optional">(optionnel)</span>
                    </label>
                    {{ form_widget(form.message, {'attr': {'class': 'form-textarea', 'placeholder': 'Parlez-nous de vous, de votre parcours, de vos motivations...'}}) }}
                    {{ form_errors(form.message) }}
                </div>
            </div>

            {{ form_widget(form.submit, {'attr': {'class': 'submit-btn', 'id': 'submitBtn'}, 'label': 'Envoyer ma candidature ‚Üí'}) }}

        {{ form_end(form) }}
    </div>

    <!-- ‚îÄ‚îÄ Message de succ√®s ‚îÄ‚îÄ -->
    <div id="successMessage" class="success-message" style="display:none;">
        <div class="success-icon">‚úì</div>
        <p>Merci, votre candidature a bien √©t√© re√ßue.</p>
        <p style="font-size:16px; margin-top:10px; font-weight:400;">
            Nous examinerons votre profil avec attention et reviendrons vers vous tr√®s prochainement.
        </p>
        <a href="{{ path('app_home') }}" class="success-link">Retour √† l'accueil</a>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form      = document.getElementById('candidatureForm');
            const submitBtn = document.getElementById('submitBtn');
            const cvInput   = document.getElementById('{{ form.cvFile.vars.id }}');
            const cvLabel   = document.getElementById('cvLabel');
            const cvFileName = document.getElementById('cvFileName');

            // ‚îÄ‚îÄ Validation et aper√ßu du CV ‚îÄ‚îÄ
            if (cvInput) {
                cvInput.addEventListener('change', function () {
                    const file = this.files[0];
                    if (!file) {
                        cvFileName.textContent = '';
                        cvLabel.classList.add('required-file');
                        cvLabel.style.cssText = '';
                        return;
                    }
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Le fichier est trop volumineux. Taille maximale : 5 Mo');
                        this.value = '';
                        cvFileName.textContent = '';
                        cvLabel.classList.add('required-file');
                        return;
                    }
                    if (file.type !== 'application/pdf') {
                        alert('Seuls les fichiers PDF sont accept√©s');
                        this.value = '';
                        cvFileName.textContent = '';
                        cvLabel.classList.add('required-file');
                        return;
                    }
                    const size = (file.size / 1024 / 1024).toFixed(2);
                    cvFileName.textContent = '‚úì ' + file.name + ' (' + size + ' Mo)';
                    cvFileName.classList.add('success');
                    cvLabel.classList.remove('required-file');
                    cvLabel.style.borderColor = '#27ae60';
                    cvLabel.style.background  = '#f0faf4';
                    cvLabel.style.color       = '#27ae60';
                });
            }

            // ‚îÄ‚îÄ D√©sactivation √† la soumission ‚îÄ‚îÄ
            if (form) {
                form.addEventListener('submit', function () {
                    submitBtn.disabled    = true;
                    submitBtn.value       = 'Envoi en cours‚Ä¶';
                });
            }

            // ‚îÄ‚îÄ Validation t√©l√©phone ‚îÄ‚îÄ
            const phoneInput = document.querySelector('input[type="tel"]');
            if (phoneInput) {
                phoneInput.addEventListener('blur', function () {
                    const regex = /^(?:(?:\+|00)33|0)\s*[1-9](?:[\s.-]*\d{2}){4}$/;
                    this.style.borderColor = (this.value && !regex.test(this.value)) ? '#e74c3c' : '';
                });
            }

            // ‚îÄ‚îÄ Affichage du succ√®s si flash pr√©sent ‚îÄ‚îÄ
            {% if app.flashes('success')|length > 0 %}
                document.getElementById('formContainer').style.display    = 'none';
                document.getElementById('successMessage').style.display   = 'block';
            {% endif %}
        });
    </script>
{% endblock %}

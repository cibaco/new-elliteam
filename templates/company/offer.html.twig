{% extends 'new_base.html.twig' %}

{% block title %}Elliteam - Je dÃ©pose une offre{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/companies.css') }}">
{% endblock %}

{% block main %}
    <a href="{{ path('app_home') }}" class="back-link">Retour Ã  l'accueil</a>

    <!-- â”€â”€ Header â”€â”€ -->
    <div class="offer-header">
        <span class="offer-header__badge">Entreprises</span>
        <h2>Je dÃ©pose une offre</h2>
        <p>Confiez-nous votre besoin en recrutement CDI ou en prestation digitale.<br>Nous revenons vers vous sous 24h.</p>
        <div class="offer-header__badges">
            <span class="offer-badge">ðŸ’¼ CDI</span>
            <span class="offer-badge">ðŸš€ Prestation</span>
            <span class="offer-badge">âš¡ RÃ©ponse sous 24h</span>
        </div>
    </div>

    {% for message in app.flashes('error') %}
        <div class="alert alert-error" role="alert">{{ message }}</div>
    {% endfor %}

    <!-- â”€â”€ Formulaire â”€â”€ -->
    <div id="formContainer">
        {{ form_start(form, {'attr': {'id': 'offerForm', 'class': 'offer-form', 'novalidate': 'novalidate'}}) }}

            <!-- Section 1 : Vos coordonnÃ©es -->
            <div class="form-section">
                <div class="form-section__title">
                    <span class="form-section__number">1</span>
                    Vos coordonnÃ©es
                </div>

                <div class="form-row">
                    <div class="form-group">
                        {{ form_label(form.name, null, {'label_attr': {'class': 'form-label'}}) }}
                        <span class="required">*</span>
                        {{ form_widget(form.name, {'attr': {'class': 'form-input', 'placeholder': 'Votre nom complet'}}) }}
                        {{ form_errors(form.name) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.company, null, {'label_attr': {'class': 'form-label'}}) }}
                        <span class="required">*</span>
                        {{ form_widget(form.company, {'attr': {'class': 'form-input', 'placeholder': 'Nom de votre entreprise'}}) }}
                        {{ form_errors(form.company) }}
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        {{ form_label(form.email, null, {'label_attr': {'class': 'form-label'}}) }}
                        <span class="required">*</span>
                        {{ form_widget(form.email, {'attr': {'class': 'form-input', 'placeholder': 'votre.email@entreprise.com'}}) }}
                        {{ form_errors(form.email) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.phone, null, {'label_attr': {'class': 'form-label'}}) }}
                        <span class="required">*</span>
                        {{ form_widget(form.phone, {'attr': {'class': 'form-input', 'placeholder': '06 12 34 56 78'}}) }}
                        {{ form_errors(form.phone) }}
                    </div>
                </div>
            </div>

            <!-- Section 2 : Votre besoin -->
            <div class="form-section">
                <div class="form-section__title">
                    <span class="form-section__number">2</span>
                    Votre besoin
                </div>

                <div class="form-row">
                    <div class="form-group">
                        {{ form_label(form.needType, null, {'label_attr': {'class': 'form-label'}}) }}
                        <span class="required">*</span>
                        {{ form_widget(form.needType, {'attr': {'class': 'form-select'}}) }}
                        {{ form_errors(form.needType) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.position, null, {'label_attr': {'class': 'form-label'}}) }}
                        <span class="required">*</span>
                        {{ form_widget(form.position, {'attr': {'class': 'form-input', 'placeholder': 'Ex: DÃ©veloppeur web, Chef de projet...'}}) }}
                        {{ form_errors(form.position) }}
                    </div>
                </div>

                <div class="form-group">
                    {{ form_label(form.description, null, {'label_attr': {'class': 'form-label'}}) }}
                    <span class="required">*</span>
                    {{ form_widget(form.description, {'attr': {'class': 'form-textarea', 'placeholder': 'DÃ©crivez votre besoin, les compÃ©tences recherchÃ©es, le contexte du poste...'}}) }}
                    {{ form_errors(form.description) }}
                </div>
            </div>

            <!-- Section 3 : PiÃ¨ce jointe -->
            <div class="form-section">
                <div class="form-section__title">
                    <span class="form-section__number">3</span>
                    PiÃ¨ce jointe <span class="optional">(optionnelle)</span>
                </div>

                <div class="form-group">
                    <div class="file-input-wrapper">
                        <label for="{{ form.attachment.vars.id }}" class="file-input-label" id="attachLabel">
                            <span>ðŸ“Ž</span>
                            <span>Joindre un fichier (PDF, DOCX â€” max 5 Mo)</span>
                        </label>
                        {{ form_widget(form.attachment, {'attr': {'class': 'file-input'}}) }}
                    </div>
                    <div id="fileName" class="file-name"></div>
                    {{ form_errors(form.attachment) }}
                </div>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                Envoyer ma demande â†’
            </button>

        {{ form_end(form) }}
    </div>

    <!-- â”€â”€ Message de succÃ¨s â”€â”€ -->
    <div id="successMessage" class="success-message" style="display:none;">
        <div class="success-icon">âœ“</div>
        <p>Merci, votre demande a bien Ã©tÃ© reÃ§ue.</p>
        <p style="font-size:16px; margin-top:10px; font-weight:400;">
            Notre Ã©quipe vous recontacte sous 24h.
        </p>
        <a href="{{ path('app_home') }}" class="success-link">Retour Ã  l'accueil</a>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // â”€â”€ Fichier joint â”€â”€
            const attachInput = document.getElementById('{{ form.attachment.vars.id }}');
            const attachLabel = document.getElementById('attachLabel');
            const fileNameEl  = document.getElementById('fileName');

            if (attachInput) {
                attachInput.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const size = (file.size / 1024 / 1024).toFixed(2);
                        fileNameEl.textContent = 'âœ“ ' + file.name + ' (' + size + ' Mo)';
                        fileNameEl.classList.add('success');
                        attachLabel.style.borderColor = '#27ae60';
                        attachLabel.style.background  = '#f0faf4';
                        attachLabel.style.color       = '#27ae60';
                    } else {
                        fileNameEl.textContent = '';
                        fileNameEl.classList.remove('success');
                        attachLabel.style.cssText = '';
                    }
                });
            }

            // â”€â”€ DÃ©sactivation du bouton Ã  la soumission â”€â”€
            const form      = document.getElementById('offerForm');
            const submitBtn = document.getElementById('submitBtn');
            if (form) {
                form.addEventListener('submit', function () {
                    submitBtn.disabled    = true;
                    submitBtn.textContent = 'Envoi en coursâ€¦';
                });
            }

            // â”€â”€ Affichage du succÃ¨s si flash prÃ©sent â”€â”€
            {% if app.flashes('success')|length > 0 %}
                document.getElementById('formContainer').style.display    = 'none';
                document.getElementById('successMessage').style.display   = 'block';
            {% endif %}
        });
    </script>
{% endblock %}

{% extends 'new_base.html.twig' %}

{% block title %}Elliteam - Je d√©pose une offre{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/new_style.css') }}">
    <link rel="stylesheet"  href="{{ asset('css/companies.css') }}">
{% endblock stylesheets %}

{% block main %}
    <!-- Main content -->
    <h2 class="page-title">Je d√©pose une offre</h2>
    <p class="page-subtitle">
        Remplissez le formulaire ci-dessous pour nous confier votre besoin en recrutement CDI ou en prestation.
    </p>

    {% for message in app.flashes('error') %}
        <div class="alert alert-error">
            {{ message }}
        </div>
    {% endfor %}

    <!-- Form -->
    {{ form_start(form, {
        'attr': {
            'id': 'offerForm',
            'class': 'form-container'
        }
    }) }}

    <div class="form-group">
        {{ form_label(form.name, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.name) }}
        {{ form_errors(form.name) }}
    </div>

    <div class="form-group">
        {{ form_label(form.company, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.company) }}
        {{ form_errors(form.company) }}
    </div>

    <div class="form-group">
        {{ form_label(form.email, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.email) }}
        {{ form_errors(form.email) }}
    </div>

    <div class="form-group">
        {{ form_label(form.phone, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.phone) }}
        {{ form_errors(form.phone) }}
    </div>

    <div class="form-group">
        {{ form_label(form.needType, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.needType) }}
        {{ form_errors(form.needType) }}
    </div>

    <div class="form-group">
        {{ form_label(form.position, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.position) }}
        {{ form_errors(form.position) }}
    </div>

    <div class="form-group">
        {{ form_label(form.description, null, {'label_attr': {'class': 'form-label'}}) }}
        <span class="required">*</span>
        {{ form_widget(form.description) }}
        {{ form_errors(form.description) }}
    </div>

    <div class="form-group">
        {{ form_label(form.attachment, null, {'label_attr': {'class': 'form-label'}}) }}
        <div class="file-input-wrapper">
            <label for="{{ form.attachment.vars.id }}" class="file-input-label">
                <span>üìé</span>
                <span>Joindre un fichier (PDF, DOCX, max 5 Mo)</span>
            </label>
            {{ form_widget(form.attachment) }}
        </div>
        <div id="fileName" class="file-name"></div>
        {{ form_errors(form.attachment) }}
    </div>

    <button type="submit" class="submit-btn">Envoyer ma demande</button>

    {{ form_end(form) }}

    <!-- Success message -->
    <div id="successMessage" class="success-message" style="display: none;">
        <div class="success-icon">‚úì</div>
        <p>Merci, votre demande a bien √©t√© re√ßue.</p>
        <p style="font-size: 16px; margin-top: 10px; font-weight: 400;">Nous reviendrons vers vous tr√®s prochainement.</p>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        // Affichage du nom du fichier s√©lectionn√©
        document.getElementById('{{ form.attachment.vars.id }}').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            const fileNameDisplay = document.getElementById('fileName');
            if (fileName) {
                fileNameDisplay.textContent = 'üìÑ ' + fileName;
                fileNameDisplay.style.display = 'block';
            } else {
                fileNameDisplay.style.display = 'none';
            }
        });

        // Affichage du message de succ√®s si pr√©sent dans les flash messages
        {% if app.flashes('success')|length > 0 %}

        console.log(document.getElementById('offerForm'));
        // Twig g√©n√®re ce code JavaScript uniquement si flash existe
            document.getElementById('successMessage').classList.remove('d-none');
            document.getElementById('offerForm').classList.add('hidden');
            document.getElementById('offerForm').classList.add('d-none');
        {% endif %}
    </script>
{% endblock %}
